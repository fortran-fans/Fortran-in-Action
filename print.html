<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>fortran-best-practices</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Fortran-Best-Practices/introduction.html"><strong aria-hidden="true">1.</strong> Fortranæœ€ä½³å®è·µ</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Fortran-Best-Practices/fortran-style-guide.html"><strong aria-hidden="true">1.1.</strong> Fortrané£æ ¼æŒ‡å¯¼</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/floating-point-numbers.html"><strong aria-hidden="true">1.2.</strong> æµ®ç‚¹æ•°</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/integer-division.html"><strong aria-hidden="true">1.3.</strong> æ•´æ•°é™¤æ³•</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/modules-programs.html"><strong aria-hidden="true">1.4.</strong> æ¨¡å—</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/arrays.html"><strong aria-hidden="true">1.5.</strong> æ•°ç»„</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/multidim-arrays.html"><strong aria-hidden="true">1.6.</strong> é«˜ç»´æ•°ç»„</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/element-operation.html"><strong aria-hidden="true">1.7.</strong> é€å…ƒæ“ä½œ</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/allocatable-arrays.html"><strong aria-hidden="true">1.8.</strong> å¯åˆ†é…æ•°ç»„</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/file-io.html"><strong aria-hidden="true">1.9.</strong> æ–‡ä»¶io</a></li><li class="chapter-item expanded "><a href="Fortran-Best-Practices/callbacks.html"><strong aria-hidden="true">1.10.</strong> å›è°ƒå‡½æ•°</a></li></ol></li><li class="chapter-item expanded "><a href="Fortran-Programming-in-Windows/index.html"><strong aria-hidden="true">2.</strong> åœ¨Windowsç³»ç»Ÿä¸‹è¿›è¡ŒFortranç¼–ç¨‹</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Fortran-Programming-in-Windows/use-GFortran-in-Windows.html"><strong aria-hidden="true">2.1.</strong> åœ¨Windowsç³»ç»Ÿä¸‹ä½¿ç”¨GFortran</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">fortran-best-practices</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/fortran-fans/mdbook-test/tree/main/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="å…³äºæœ¬ä¹¦fortranæœ€ä½³å®è·µ"><a class="header" href="#å…³äºæœ¬ä¹¦fortranæœ€ä½³å®è·µ">å…³äºæœ¬ä¹¦ï¼ˆã€ŠFortranæœ€ä½³å®è·µã€‹ï¼‰</a></h1>
<p>ä½œè€…ï¼šOndÅ™ej ÄŒertÃ­kã€John Paskã€Jed Brownã€Matthew Emmettã€Juan Luis Cano RodrÃ­guezã€Neil Carlsonã€Andrea Vigliottiã€Pierre Haessigã€Vincent Magninã€Sebastian Ehlertã€Jeremie Vandenplas</p>
<p>æ­¤ä¹¦æ”¶é›†äº†ä¸€äº›ç°ä»£ä¸”è§„èŒƒç¼–å†™Fortrançš„æ–¹æ³•ï¼Œå°†é’ˆå¯¹å¸¸è§çš„è¯é¢˜å’Œä»»åŠ¡è¿›è¡Œä»£ç é£æ ¼æŒ‡å¯¼ï¼Œä»¥åŠæ¨èæœ€ä½³å®è·µæ–¹æ³•ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå®ƒä¼šåˆ—ä¸¾å’Œè®¨è®ºä¸€äº›è§„èŒƒçš„è§£å†³æ–¹æ¡ˆå’Œæ¨¡å¼ã€‚è¿™æœ¬ä¹¦ä¸»è¦é¢å‘å·²ç»å¯¹Fortranè¯­æ³•å’Œç¼–å†™æœ‰åŸºæœ¬äº†è§£çš„ç¼–ç¨‹è€…ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="fortrané£æ ¼æŒ‡å¯¼"><a class="header" href="#fortrané£æ ¼æŒ‡å¯¼">Fortrané£æ ¼æŒ‡å¯¼</a></h1>
<h2 id="å‘½åè§„åˆ™"><a class="header" href="#å‘½åè§„åˆ™">å‘½åè§„åˆ™</a></h2>
<p>è™½ç„¶å¦‚ä½•å‘½åå–å†³äºä¸ªäººåå¥½ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™é‡Œç»™å‡ºä¸€ä»½æˆ‘ä»¬å–œæ¬¢çš„ï¼Œå¹¶ä¸”åœ¨å¾ˆå¤šç§‘å­¦è®¡ç®—ä»£ç ï¼ˆä»¥åŠFortran standard libraryï¼‰ä¸­æµè¡Œçš„é£æ ¼ã€‚æ¬¢è¿ä½ ä¹Ÿä½¿ç”¨è¿™ä¸€é£æ ¼ã€‚</p>
<ol>
<li>åœ¨æ‰€æœ‰Fortranç»“æ„ä¸­ä½¿ç”¨å°å†™å­—æ¯ï¼ˆ<code>do</code>ã€<code>subroutine</code>ã€<code>module</code>â€¦â€¦ï¼‰</li>
<li>å¯¹äºæ•°å­¦å˜é‡/å‡½æ•°ä½¿ç”¨ç®€çŸ­çš„æ•°å­¦ä¸Šçš„è®°å·ï¼ˆ<code>Ylm</code>ã€<code>Gamma</code>ã€<code>gamma</code>ã€<code>Enl</code>ã€<code>Rnl</code>â€¦â€¦ï¼‰</li>
<li>å…¶ä»–çš„åå­—å…¨éƒ¨éƒ½ç”¨å°å†™å­—æ¯ï¼šå°½é‡è®©åå­—ä¸ºä¸€åˆ°ä¸¤ä¸ªéŸ³èŠ‚ï¼›å¦‚æœéœ€è¦æ›´å¤šéŸ³èŠ‚ï¼Œåˆ™ç”¨ä¸‹åˆ’çº¿ä½¿å…¶çœ‹ç€æ¸…æ™°ï¼ˆ<code>sortpair</code>ã€<code>whitechar</code>ã€<code>meshexp</code>ã€<code>numstrings</code>ã€<code>linspace</code>ã€<code>meshgrid</code>ã€<code>argsort</code>ã€<code>spline</code>ã€<code>spline_interp</code>ã€<code>spline_interpolate</code>ã€<code>stoperr</code>ã€<code>stop_error</code>ã€<code>meshexp_der</code>ï¼‰</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æµ®ç‚¹æ•°"><a class="header" href="#æµ®ç‚¹æ•°">æµ®ç‚¹æ•°</a></h1>
<p>æµ®ç‚¹æ•°çš„é»˜è®¤è¡¨ç¤ºå½¢å¼æ˜¯ä½¿ç”¨å•ç²¾åº¦ï¼ˆé€šå¸¸ä¸º32ä½/4å­—èŠ‚ï¼‰ã€‚å¯¹äºå¤§å¤šæ•°ç¨‹åºè€Œè¨€ï¼Œéœ€è¦æ›´é«˜çš„ç²¾åº¦ã€‚
ä¸ºæ­¤ï¼Œå¯ä»¥è‡ªå®šä¹‰ç§ç±»ï¼ˆkindï¼‰å‚æ•°ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰ç§ç±»å‚æ•°</p>
<pre><code class="language-fortran">integer, parameter :: dp = selected_real_kind(15)
</code></pre>
<p>åœ¨å¾ˆå¤šæƒ…æ™¯ä¸‹ï¼Œé€šè¿‡å­—é¢å€¼å¸¸é‡æ¨å¯¼å¾—åˆ°ç§ç±»å‚æ•°ä¹Ÿè¶³ä»¥æ»¡è¶³éœ€æ±‚</p>
<pre><code class="language-fortran">integer, parameter :: dp = kind(0.0d0)
</code></pre>
<p>æˆ–å°†<code>iso_fortran_env</code>å†…ç½®æ¨¡å—ä¸­å¯¼å…¥çš„ç§ç±»å‚æ•°é‡å‘½åï¼Œ</p>
<pre><code class="language-fortran">use, intrinsic :: iso_fortran_env, only : dp =&gt; real64
</code></pre>
<p>æœ‰å…³ç§ç±»å‚æ•°çš„ä¸€äº›æ·±åˆ»çš„è§è§£ï¼Œè¯·çœ‹
<a href="https://web.archive.org/web/20200930090137/https://stevelionel.com/drfortran/2017/03/27/doctor-fortran-in-it-takes-all-kinds/">Doctor Fortran in it takes all KINDs</a>.</p>
<p>æˆ‘ä»¬å»ºè®®æ„å»ºä¸€ä¸ªæ ¸å¿ƒæ¨¡å—æ¥å®šä¹‰ç§ç±»å‚æ•°ï¼Œå¹¶åœ¨å¿…è¦æ—¶å¼•å…¥å®ƒä»¬ã€‚
åœ¨æ­¤ï¼Œç»™å‡ºæ­¤ç±»æ¨¡å—çš„ç¤ºä¾‹ï¼Œ</p>
<pre><code class="language-fortran">!&gt; Numerical storage size parameters for real and integer values
module kind_parameter
   implicit none
   public

   !&gt; Single precision real numbers, 6 digits, range 10â»Â³â· to 10Â³â·-1; 32 bits
   integer, parameter :: sp = selected_real_kind(6, 37)
   !&gt; Double precision real numbers, 15 digits, range 10â»Â³â°â· to 10Â³â°â·-1; 64 bits
   integer, parameter :: dp = selected_real_kind(15, 307)
   !&gt; Quadruple precision real numbers, 33 digits, range 10â»â´â¹Â³Â¹ to 10â´â¹Â³Â¹-1; 128 bits
   integer, parameter :: qp = selected_real_kind(33, 4931)

   !&gt; Char length for integers, range -2â· to 2â·-1; 8 bits
   integer, parameter :: i1 = selected_int_kind(2)
   !&gt; Short length for integers, range -2Â¹âµ to 2Â¹âµ-1; 16 bits
   integer, parameter :: i2 = selected_int_kind(4)
   !&gt; Length of default integers, range -2Â³Â¹ to 2Â³Â¹-1; 32 bits
   integer, parameter :: i4 = selected_int_kind(9)
   !&gt; Long length for integers, range -2â¶Â³ to 2â¶Â³-1; 64 bits
   integer, parameter :: i8 = selected_int_kind(18)

end module kind_parameter
</code></pre>
<p>å£°æ˜æµ®ç‚¹å¸¸é‡ï¼Œåº”å§‹ç»ˆå†™å‡ºç§ç±»å‚æ•°åç¼€ï¼Œ</p>
<pre><code class="language-fortran">real(dp) :: a, b, c
a = 1.0_dp
b = 3.5_dp
c = 1.34e8_dp
</code></pre>
<p>å°†æ•´æ•°èµ‹å€¼ç»™æµ®ç‚¹æ•°ï¼ˆä¸è¶…è¿‡æœ‰æ•ˆæ•°å­—é™åˆ¶çš„æ•´æ•°ï¼‰æ˜¯å®‰å…¨çš„ï¼Œä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚</p>
<pre><code class="language-fortran">real(dp) :: a
a = 3
</code></pre>
<p>ä¸ºäº†å¼ºåˆ¶ä½¿ç”¨æµ®ç‚¹é™¤æ³•ï¼ˆä¸æ•´æ•°é™¤æ³•<code>3/4==0</code>ä¸åŒï¼‰ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å°†æ•´æ•°è½¬æ¢ä¸ºæµ®ç‚¹æ•°ï¼Œ</p>
<pre><code class="language-fortran">real(dp) :: a
a = real(3, dp) / 4  ! 'a' is equal to 0.75_dp
</code></pre>
<p>æˆ–è€…ç®€å•åœ°ç”¨ä¹˜ä»¥<code>1.0_dp</code>çš„ä¹˜æ³•åˆ†éš”æ•´æ•°é™¤æ³•ã€‚</p>
<p>è¦åœ¨ä¸ä¸¢å¤±ç²¾åº¦çš„æƒ…å†µä¸‹æ‰“å°æµ®ç‚¹æ•°ï¼Œä½¿ç”¨æ— é™åˆ¶æ ¼å¼<code>&quot;(g0)&quot;</code>æˆ–æŒ‡æ•°è¡¨ç¤ºæ³•<code>&quot;(es24.16e3)&quot;</code>ï¼Œä¼šæä¾›17ä½æœ‰æ•ˆæ•°å­—çš„æ‰“å°è¾“å‡ºã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ•´æ•°é™¤æ³•"><a class="header" href="#æ•´æ•°é™¤æ³•">æ•´æ•°é™¤æ³•</a></h1>
<p>FortranåŒºåˆ†æµ®ç‚¹è¿ç®—å’Œæ•´æ•°è¿ç®—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ•´æ•°é™¤æ³•æ€»æ˜¯ä½¿ç”¨æ•´æ•°ç®—æœ¯ã€‚
æ­¤å¤–ï¼Œè™½ç„¶Fortranä½¿ç”¨æ ‡å‡†çš„è¿ç®—é¡ºåºï¼ˆä¾‹å¦‚ï¼Œåœ¨æ²¡æœ‰æ‹¬å·çš„æƒ…å†µä¸‹ï¼Œä¹˜é™¤æ³•ä¼˜å…ˆçº§é«˜äºåŠ å‡æ³•ï¼‰ï¼Œ
ä½†ç›¸åŒä¼˜å…ˆçº§çš„è¿ç®—æ˜¯ä»å·¦åˆ°å³è®¡ç®—çš„ã€‚
å¦‚ä¸‹ï¼Œè€ƒè™‘ä¸€ä¸ªå¥‡æ•°åšæ•´æ•°é™¤æ³•çš„ä¾‹å­ã€‚</p>
<pre><code class="language-fortran">integer :: n
n = 3
print *, n / 2  ! prints 1
print *, n*(n + 1)/2  ! prints 6
print *, n/2*(n + 1)  ! prints 4 (left-to-right evaluation order)
n = -3
print *, n / 2  ! prints -1
</code></pre>
<p>åœ¨å®é™…æƒ…å†µä¸­ï¼Œè¯·æ³¨æ„ä½ æ˜¯å¦çœŸçš„éœ€è¦ä½¿ç”¨æ•´æ•°ç®—æœ¯ã€‚
å¦‚æœè¦æ”¹ç”¨æµ®ç‚¹ç®—æœ¯ï¼Œè¯·ç¡®ä¿åœ¨ä½¿ç”¨é™¤æ³•è¿ç®—ç¬¦ä¹‹å‰å¼ºåˆ¶è½¬æ¢ä¸ºå®æ•°ï¼Œæˆ–é€šè¿‡ä¹˜ä»¥<code>1.0_dp</code>æ¥åˆ†éš”æ•´æ•°ã€‚</p>
<pre><code class="language-fortran">integer :: n
n = 3
print *, real(n, dp) / 2  ! prints 1.5
print *, n * 1.0_dp / 2  ! prints 1.5
n = -3
print *, real(n, dp) / 2  ! prints -1.5
print *, n * 1.0_dp / 2  ! prints -1.5
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ¨¡å—å’Œç¨‹åº"><a class="header" href="#æ¨¡å—å’Œç¨‹åº">æ¨¡å—å’Œç¨‹åº</a></h1>
<p>æ¨¡å—ï¼ˆ<code>module</code>ï¼‰æ˜¯åˆ›å»ºç°ä»£Fortranåº“å’Œåº”ç”¨ç¨‹åºçš„é¦–é€‰æ–¹æ³•ã€‚
æŒ‰ç…§æƒ¯ä¾‹ï¼Œä¸€ä¸ªæºæ–‡ä»¶åº”å§‹ç»ˆåªåŒ…å«ä¸€ä¸ªæ¨¡å—ï¼Œè€Œæ¨¡å—åç§°åº”ä¸æ–‡ä»¶è·¯å¾„åŒ¹é…ï¼Œä»¥ä¾¿åœ¨è¾ƒå¤§çš„é¡¹ç›®ä¸­å¯ä»¥è½»æ¾æµè§ˆã€‚
æ­¤å¤–è¿˜å»ºè®®åœ¨æ¨¡å—åå‰åŠ ä¸Šåº“åï¼Œä»¥é¿å…åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½œä¸ºä¾èµ–é¡¹ä½¿ç”¨æ—¶å‘ç”Ÿåç§°å†²çªã€‚
è¿™é‡Œç»™å‡ºäº†ä¸€ä¸ªæ¨¡å—æ–‡ä»¶çš„ç¤ºä¾‹ï¼Œ</p>
<pre><code class="language-fortran">!&gt; Interface to TOML processing library.
!&gt;
!&gt; ...
module fpm_toml
  use fpm_error, only : error_t, fatal_error, file_not_found_error
  use fpm_strings, only : string_t
  use tomlf, only : toml_table, toml_array, toml_key, toml_stat, get_value, &amp;
    &amp; set_value, toml_parse, toml_error, new_table, add_table, add_array, &amp;
    &amp; toml_serializer, len
  implicit none
  private

  public :: read_package_file
  public :: toml_table, toml_array, toml_key, toml_stat, get_value, set_value
  public :: new_table, add_table, add_array, len
  public :: toml_error, toml_serializer, toml_parse

contains

  !&gt; Process the configuration file to a TOML data structure
  subroutine read_package_file(table, manifest, error)
    !&gt; TOML data structure
    type(toml_table), allocatable, intent(out) :: table
    !&gt; Name of the package configuration file
    character(len=*), intent(in) :: manifest
    !&gt; Error status of the operation
    type(error_t), allocatable, intent(out) :: error
    ! ...
  end subroutine read_package_file

end module fpm_toml
</code></pre>
<p>æœ¬ç¤ºä¾‹æ¨¡å—ä¸­æœ‰å‡ ç‚¹éœ€è¦å¼ºè°ƒã€‚
é¦–å…ˆï¼Œæ¯ä¸ªæ¨¡å—éƒ½ä»¥æ³¨é‡Šå¼€å§‹ï¼Œè®°å½•æ¨¡å—çš„ç›®çš„å’Œå†…å®¹ã€‚
ç±»ä¼¼çš„ï¼Œæ¯ä¸ªè¿‡ç¨‹éƒ½ä»¥ä¸€æ¡æ³¨é‡Šå¼€å§‹ï¼Œç®€è¦æè¿°å…¶ç›®çš„å’Œè™šå‚çš„æ„ä¹‰ã€‚
æ— è®ºä½¿ç”¨ä½•ç§è¯­è¨€ï¼Œæ–‡æ¡£éƒ½æ˜¯åˆ›å»ºé•¿æœŸè½¯ä»¶çš„æœ€é‡è¦éƒ¨åˆ†ä¹‹ä¸€ã€‚</p>
<p>å…¶æ¬¡ï¼Œæ˜¾å¼åœ°å¯¼å…¥<code>use</code>å’Œå¯¼å‡º<code>public</code>ï¼Œé€šè¿‡æµè§ˆæ¨¡å—çš„æºä»£ç æ¥æ£€æŸ¥å·²ç»ä½¿ç”¨çš„å’Œå¯ç”¨çš„è¿‡ç¨‹ã€å¸¸é‡å’Œæ´¾ç”Ÿç±»å‹ã€‚
å¯¼å…¥é€šå¸¸åº”é™äºæ¨¡å—èŒƒå›´ï¼Œè€Œä¸æ˜¯åœ¨æ¯ä¸ªè¿‡ç¨‹æˆ–æ¥å£èŒƒå›´ä¸­é‡æ–°å¯¼å…¥ã€‚
ç±»ä¼¼çš„ï¼Œé€šè¿‡åœ¨ä¸€è¡Œä¸Šæ·»åŠ <code>private</code>è¯­å¥å¹¶åœ¨<code>public</code>è¯­å¥ä¸­æ˜¾å¼åˆ—å‡ºæ‰€æœ‰å¯¼å‡ºç¬¦å·ï¼Œå¯ä»¥æ˜¾å¼åœ°è¿›è¡Œå¯¼å‡ºã€‚</p>
<p>æœ€åï¼Œ<code>implicit none</code>è¯­å¥åœ¨æ•´ä¸ªæ¨¡å—ç”Ÿæ•ˆï¼Œä¸éœ€è¦åœ¨æ¯ä¸ªè¿‡ç¨‹ä¸­é‡å¤ä½¿ç”¨å®ƒã€‚</p>
<p>æ¨¡å—ä¸­çš„å˜é‡æ˜¯é™æ€çš„ï¼ˆ<em>é»˜è®¤saveå±æ€§</em>ï¼‰ã€‚
å¼ºçƒˆå»ºè®®å°†æ¨¡å—å˜é‡çš„ä½¿ç”¨é™åˆ¶ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œæ¯”å¦‚åªä½¿ç”¨å¸¸æ•°æˆ–æšä¸¾å¯¹è±¡ï¼Œæˆ–è€…å°†å®ƒä»¬å¯¼å‡ºè®¾ç½®ä¸º<code>protected</code>è€Œä¸æ˜¯<code>public</code>ã€‚</p>
<p>åœ¨Fortranç¨‹åºä¸­ï¼Œå­æ¨¡å—ï¼ˆ<code>submodule</code>ï¼‰å¯ä»¥ç”¨æ¥æ‰“ç ´é•¿ä¾èµ–é“¾ï¼Œç¼©çŸ­é‡æ–°ç¼–è¯‘çš„æ—¶é—´ã€‚
å®ƒä»¬ä½¿å¾—æˆ‘ä»¬åœ¨ä¸ä½¿ç”¨é¢„å¤„ç†å™¨çš„æƒ…å†µä¸‹ï¼Œæä¾›ä¸“ç”¨åŒ–å’Œç»è¿‡ä¼˜åŒ–çš„ç¨‹åºå®ç°ã€‚</p>
<p>å¦‚ä¸‹ç¤ºä¾‹æ˜¯Fortranæ ‡å‡†åº“<a href="https://github.com/fortran-lang/stdlib">stdlib</a>ä¸­çš„ç§¯åˆ†æ¨¡å—ï¼Œ
æ­¤å¤„åªå®šä¹‰äº†æ¨¡å—è¿‡ç¨‹çš„æ¥å£ï¼Œè€Œæ²¡æœ‰å®ç°ã€‚</p>
<pre><code class="language-fortran">!&gt; Numerical integration
!&gt;
!&gt; ...
module stdlib_quadrature
  use stdlib_kinds, only: sp, dp, qp
  implicit none
  private

  public :: trapz
  ! ...

  !&gt; Integrates sampled values using trapezoidal rule
  interface trapz
    pure module function trapz_dx_dp(y, dx) result(integral)
      real(dp), intent(in) :: y(:)
      real(dp), intent(in) :: dx
      real(dp) :: integral
    end function trapz_dx_dp
    module function trapz_x_dp(y, x) result(integral)
      real(dp), intent(in) :: y(:)
      real(dp), intent(in) :: x(:)
      real(dp) :: integral
    end function trapz_x_dp
  end interface trapz

  ! ...
end module stdlib_quadrature
</code></pre>
<p>å…·ä½“å®ç°æ˜¯åœ¨å•ç‹¬çš„å­æ¨¡å—ä¸­æä¾›çš„ï¼Œæ¯”å¦‚è¿™é‡Œç»™å‡ºçš„æ¢¯å½¢ç§¯åˆ†è§„åˆ™ã€‚</p>
<pre><code class="language-fortran">!&gt; Actual implementation of the trapezoidal integration rule
!&gt;
!&gt; ...
submodule (stdlib_quadrature) stdlib_quadrature_trapz
  use stdlib_error, only: check
  implicit none

contains

  pure module function trapz_dx_dp(y, dx) result(integral)
    real(dp), intent(in) :: y(:)
    real(dp), intent(in) :: dx
    real(dp) :: integral
    integer :: n

    n = size(y)
    select case (n)
    case (0:1)
      integral = 0.0_dp
    case (2)
      integral = 0.5_dp*dx*(y(1) + y(2))
    case default
      integral = dx*(sum(y(2:n-1)) + 0.5_dp*(y(1) + y(n)))
    end select
  end function trapz_dx_dp

  ! ...
end submodule stdlib_quadrature_trapz
</code></pre>
<p>è¯·æ³¨æ„ï¼Œæ¨¡å—è¿‡ç¨‹ä¸å¿…åœ¨åŒä¸€ä¸ªå­æ¨¡å—ä¸­å®ç°ï¼Œå¯ä»¥ä½¿ç”¨å¤šä¸ªå­æ¨¡å—æ¥å‡å°‘å¤§å‹æ¨¡å—çš„ç¼–è¯‘è´Ÿè½½ã€‚</p>
<p>æœ€åï¼Œåœ¨æ„å»ºç¨‹åºæ—¶ï¼Œæ¨èå°½å¯èƒ½å°‘åœ°åœ¨ç¨‹åºä¸»ä½“å†…ç•™ä¸‹æœ€ç»ˆçš„å®ç°ã€‚è€Œé€šè¿‡ä»æ¨¡å—ä¸­å¤ç”¨ä»£ç å®ç°ï¼Œèƒ½ä½¿ä½ å†™å‡ºå¯è¢«å¤ç”¨çš„ä»£ç ï¼Œå¹¶ä¸“æ³¨äºå°†ç”¨æˆ·è¾“å…¥ä¼ é€’åˆ°åº“å‡½æ•°å’Œåº“å¯¹è±¡çš„ç¨‹åºå•å…ƒã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ•°ç»„"><a class="header" href="#æ•°ç»„">æ•°ç»„</a></h1>
<p>æ•°ç»„æ˜¯Fortrançš„æ ¸å¿ƒå¯¹è±¡ã€‚åŠ¨æ€å¤§å°æ•°ç»„çš„åˆ›å»ºåœ¨<a href="Fortran-Best-Practices/./allocatable_arrays.html">å¯åˆ†é…æ•°ç»„</a>ä¸­è®¨è®º.
å°†æ•°ç»„ä¼ é€’åˆ°è¿‡ç¨‹æœ‰å››ç§æ–¹å¼</p>
<ol>
<li><em>å‡å®šå½¢çŠ¶æ•°ç»„ï¼ˆassumed-shape arraysï¼‰</em> </li>
<li><em>å‡å®šç»´åº¦æ•°ç»„ï¼ˆassumed-rank arraysï¼‰</em></li>
<li><em>æ˜¾å¼å½¢çŠ¶æ•°ç»„ï¼ˆexplicit-shape arraysï¼‰</em></li>
<li><em>å‡å®šå¤§å°æ•°ç»„ï¼ˆassumed-size arraysï¼‰</em></li>
</ol>
<p>å°†æ•°ç»„ä¼ é€’ç»™è¿‡ç¨‹çš„é¦–é€‰æ–¹æ³•æ˜¯<em>å‡å®šå½¢çŠ¶</em>æ•°ç»„ã€‚</p>
<pre><code class="language-fortran">subroutine f(r)
  real(dp), intent(out) :: r(:)
  integer :: n, i
  n = size(r)
  do i = 1, n
    r(i) = 1.0_dp / i**2
  end do
end subroutine f
</code></pre>
<p>é«˜ç»´æ•°ç»„ä¹Ÿå¯ä»¥ä»¥ç±»ä¼¼çš„æ–¹å¼ä¼ é€’ã€‚</p>
<pre><code class="language-fortran">subroutine g(A)
  real(dp), intent(in) :: A(:, :)
  ...
end subroutine g
</code></pre>
<p>æ•°ç»„é€šè¿‡å¦‚ä¸‹æ–¹å¼è¢«ç®€å•åœ°ä¼ å…¥ï¼Œ</p>
<pre><code class="language-fortran">real(dp) :: r(5)
call f(r)
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹æ²¡æœ‰è¿›è¡Œæ•°ç»„å¤åˆ¶ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯æ•°ç»„çš„å½¢çŠ¶å’Œå¤§å°ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨ä¼ é€’å’Œæ£€æŸ¥ï¼Œåœ¨è¿è¡Œæ—¶å¯ä»¥å¯é€‰çš„æ£€æŸ¥ã€‚
ç±»ä¼¼åœ°ï¼Œæ•°ç»„ç‰‡æ®µä¼ é€’ä¹Ÿå¯ä»¥ä¸éœ€è¦ä½¿ç”¨ä¸´æ—¶æ•°ç»„:</p>
<pre><code class="language-fortran">real(dp) :: r(10)
call f(r(1:10:2))
call f(r(2:10:2))
</code></pre>
<p>è¿™åº”è¯¥æ˜¯ä½ åœ¨å­ä¾‹ç¨‹ä¸­ä¼ é€’æ•°ç»„çš„é»˜è®¤æ–¹å¼ã€‚</p>
<p>é¿å…å°†æ•°ç»„ä½œä¸ºæ•´ç‰‡ä¼ é€’ï¼Œå› ä¸ºè¿™ä¼šæ¨¡ç³Šä»£ç çš„å®é™…æ„å›¾:</p>
<pre><code class="language-fortran">real(dp) :: r(10)
call f(r(:))
</code></pre>
<p>å¦‚æœè¦æ›´åŠ é€šç”¨çš„å°†æ•°ç»„ä¼ é€’ç»™è¿‡ç¨‹ï¼Œå¯ä»¥ä½¿ç”¨Fortran 2018æ ‡å‡†ä¸­å¼•å…¥çš„<em>å‡å®šç»´åº¦</em>åŠŸèƒ½</p>
<pre><code class="language-fortran">subroutine h(r)
  real(dp), intent(in) :: r(..)
  select rank(r)
  rank(1)
  ! ...
  rank(2)
  ! ...
  end select
end subroutine h
</code></pre>
<p>å®é™…ç»´åº¦å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨<code>select rank</code>ç»“æ„æ¥æŸ¥è¯¢ã€‚ è¿™å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºæ›´å¤šçš„æ³›å‹å‡½æ•°æ¥å¤„ç†ä¸åŒç»´åº¦çš„æ•°ç»„ã€‚</p>
<p><em>æ˜¾å¼å½¢çŠ¶</em>æ•°ç»„å¯ä»¥ç”¨äºä»å‡½æ•°è¿”å›æ•°æ®ï¼Œå®ƒä»¬çš„å¤§éƒ¨åˆ†åŠŸèƒ½å¯ä»¥ç”±<em>å‡å®šå½¢çŠ¶</em>å’Œ<em>å‡å®šç»´æ•°</em>æ•°ç»„å®Œæˆã€‚
ä½†ç”±äºå®ƒç»å¸¸ç”¨äºä¸Cæˆ–é—ç•™Fortranç¨‹åºçš„æ¥å£ï¼Œå› æ­¤åœ¨è¿™é‡Œç®€è¦è®¨è®ºã€‚</p>
<p>è¦ä½¿ç”¨<em>æ˜¾ç¤ºå½¢çŠ¶</em>æ•°ç»„ï¼Œæ•°ç»„å¤§å°å¿…é¡»æ˜¾å¼åœ°ä½œä¸ºè™šå‚ä¼ é€’ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œ</p>
<pre><code class="language-fortran">subroutine f(n, r)
  integer, intent(in) :: n
  real(dp), intent(out) :: r(n)
  integer :: i
  do i = 1, n
    r(i) = 1.0_dp / i**2
  end do
end subroutine f
</code></pre>
<p>å¯¹äºé«˜ç»´æ•°ç»„ï¼Œå¿…é¡»ä¼ é€’é¢å¤–çš„ç´¢å¼•ã€‚</p>
<pre><code class="language-fortran">subroutine g(m, n, A)
  integer, intent(in) :: m, n
  real(dp), intent(in) :: A(m, n)
  ...
end subroutine g
</code></pre>
<p>å¯ä»¥å¦‚ä¸‹æ–¹å¼è°ƒç”¨ï¼Œ</p>
<pre><code class="language-fortran">real(dp) :: r(5), s(3, 4)
call f(size(r), r)
call g(size(s, 1), size(s, 2), s)
</code></pre>
<p>æ³¨æ„ï¼Œæ­¤å¤„æ²¡æœ‰æ£€æŸ¥å½¢çŠ¶ï¼Œå› æ­¤ä»¥ä¸‹æ˜¯å¯èƒ½äº§ç”Ÿé”™è¯¯ç»“æœçš„åˆæ³•ä»£ç :</p>
<pre><code class="language-fortran">real(dp) :: s(3, 4)
call g(size(s), 1, s)  ! s(12, 1) in g
call g(size(s, 2), size(s, 1), s)  ! s(4, 3) in g
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¿ç•™äº†å†…å­˜å¸ƒå±€ï¼Œä½†æ•°ç»„çš„å½¢çŠ¶æ”¹å˜äº†ã€‚
æ­¤å¤–ï¼Œ<em>æ˜¾å¼å½¢çŠ¶</em>æ•°ç»„éœ€è¦è¿ç»­çš„å†…å­˜ï¼Œå¹¶ä¸”åœ¨é€šè¿‡éè¿ç»­æ•°ç»„åˆ‡ç‰‡è®¿é—®æ—¶,éœ€è¦åˆ›å»ºä¸´æ—¶æ•°ç»„ã€‚</p>
<p>ä½¿ç”¨å‡½æ•°è¿”å›<em>æ˜¾å¼å½¢çŠ¶</em>æ•°ç»„ï¼Œ</p>
<pre><code class="language-fortran">function f(n) result(r)
  integer, intent(in) :: n
  real(dp) :: r(n)
  integer :: i
  do i = 1, n
    r(i) = 1.0_dp / i**2
  end do
end function f
</code></pre>
<p>æœ€åï¼Œè¿˜æœ‰<em>å‡å®šå¤§å°çš„</em>æ•°ç»„ï¼Œå®ƒæä¾›æœ€å°‘çš„ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶æ£€æŸ¥ï¼Œç»å¸¸å¯ä»¥åœ¨é—ç•™ä»£ç ä¸­æ‰¾åˆ°ã€‚
å®ƒåº”è¯¥é¿å…å’Œ<em>å‡å®šå½¢çŠ¶</em>æˆ–<em>å‡å®šç»´åº¦</em>æ•°ç»„ä¸€èµ·ä½¿ç”¨ã€‚
ä¸€ä¸ª<em>å‡å®šå¤§å°</em>æ•°ç»„çš„è™šå‚è¢«æ˜Ÿå·æ ‡è¯†ä¸ºæœ€åä¸€ä¸ªç»´åº¦ï¼Œè¿™å°†ç¦æ­¢è®¸å¤šæ•°ç»„å†…ç½®å‡½æ•°çš„ä½¿ç”¨ï¼Œå¦‚<code>size</code>æˆ–<code>shape</code>ã€‚</p>
<p>è¦æ£€æŸ¥<em>å‡å®šå½¢çŠ¶</em>æ•°ç»„çš„å¤§å°å’Œå½¢çŠ¶æ˜¯å¦æ­£ç¡®ï¼Œ<code>size</code>å’Œ<code>shape</code>å†…éƒ¨å‡½æ•°å¯ç”¨äºæŸ¥è¯¢è¿™äº›å±æ€§ï¼Œ</p>
<pre><code class="language-fortran">if (size(r) /= 4) error stop &quot;Incorrect size of 'r'&quot;
if (any(shape(r) /= [2, 2])) error stop &quot;Incorrect shape of 'r'&quot;
</code></pre>
<p>æ³¨æ„ï¼Œ<code>size</code>è¿”å›æ‰€æœ‰ç»´åº¦çš„æ€»å¤§å°,è¦è·å¾—ç‰¹å®šç»´åº¦çš„å½¢çŠ¶ï¼Œè¯·å°†ç¬¬äºŒä¸ªå‚æ•°<code>dim</code>æ·»åŠ åˆ°å‡½æ•°ä¸­ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨æ•°ç»„æ„é€ å™¨åˆå§‹åŒ–æ•°ç»„</p>
<pre><code class="language-fortran">integer :: r(5)
r = [1, 2, 3, 4, 5]
</code></pre>
<p>éšå¼doå¾ªç¯ä¹Ÿå¯ä»¥åœ¨æ•°ç»„æ„é€ å™¨ä¸­ä½¿ç”¨ï¼Œ</p>
<pre><code class="language-fortran">integer :: i
real(dp) :: r(5)
r = [(real(i**2, dp), i = 1, size(r))]
</code></pre>
<p>è¦ä½¿æ•°ç»„ä¸ä»¥ç´¢å¼•1å¼€å§‹ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<pre><code class="language-fortran">subroutine print_eigenvalues(kappa_min, lam)
  integer, intent(in) :: kappa_min
  real(dp), intent(in) :: lam(kappa_min:)

  integer :: kappa
  do kappa = kappa_min, ubound(lam, 1)
    print *, kappa, lam(kappa)
  end do
end subroutine print_eigenvalues
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="é«˜ç»´æ•°ç»„"><a class="header" href="#é«˜ç»´æ•°ç»„">é«˜ç»´æ•°ç»„</a></h1>
<p>å¤šç»´æ•°ç»„æŒ‰åˆ—ä¼˜å…ˆå­˜å‚¨ï¼Œè¿™æ„å‘³ç€æœ€å·¦è¾¹ï¼ˆæœ€é‡Œé¢ï¼‰çš„ç´¢å¼•æ˜¯è¿ç»­çš„ã€‚
ä»å®é™…ä½¿ç”¨è§’åº¦æ¥çœ‹ï¼Œè¿™æ„å‘³ç€æ•°ç»„åˆ‡ç‰‡<code>V(:,1)</code>æ˜¯è¿ç»­çš„ï¼Œ
è€Œåˆ‡ç‰‡<code>V(1,:)</code>ä¸­çš„å…ƒç´ ä¹‹é—´çš„é—´éš”æ˜¯æ•°ç»„åˆ—çš„å¤§å°ã€‚
å½“å°†æ•°ç»„ç‰‡æ®µä¼ é€’ç»™å¸Œæœ›å¤„ç†è¿ç»­æ•°æ®çš„è¿‡ç¨‹æ—¶ï¼Œè¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</p>
<p>æ ¹æ®åº”ç”¨ç¨‹åºçš„ä¸åŒï¼Œè€ƒè™‘å†…å­˜çš„ä½ç½®æ˜¯å¾ˆé‡è¦çš„ï¼Œ
é€šå¸¸åœ¨å¤šç»´åº¦ä¸Šæ‰§è¡Œæ“ä½œæ—¶ï¼Œé¡ºåºè®¿é—®æ€»æ˜¯åº”è¯¥ä»¥å¤§å°ä¸º1çš„é•¿åº¦å¢åŠ ã€‚</p>
<p>åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œè®¡ç®—ä¸¤ç»„ç‚¹ä¹‹é—´è·ç¦»çš„å€’æ•°ã€‚</p>
<p>è®°è¿™äº›ç‚¹æ˜¯è¿ç»­å­˜å‚¨åœ¨æ•°ç»„<code>xyz1</code>/<code>xyz2</code> ä¸­ï¼Œ
è€Œæœ€å†…éƒ¨çš„å¾ªç¯æ˜¯çŸ©é˜µ<code>a</code>çš„æœ€å·¦è¾¹çš„ç´¢å¼•å¢åŠ ã€‚</p>
<pre><code class="language-fortran">subroutine coulomb_matrix(xyz1, xyz2, a)
  real(dp), intent(in) :: xyz1(:, :)
  real(dp), intent(in) :: xyz2(:, :)
  real(dp), intent(out) :: a(:, :)
  integer :: i, j
  do i = 1, size(a, 2)
    do j = 1, size(a, 1)
      a(j, i) = 1.0_dp/norm2(xyz1(:, j) - xyz2(:, i))
    end do
  end do
end subroutine coulomb_matrix
</code></pre>
<p>å¦ä¸€ä¸ªä¾‹å­æ˜¯ä¸‰ç»´æ•°ç»„çš„ç¬¬ä¸‰ç»´ç¼©å¹¶ï¼Œ</p>
<pre><code class="language-fortran">do i = 1, size(amat, 3)
  do j = 1, size(amat, 2)
    do k = 1, size(amat, 1)
      cmat(k, j) = cmat(k, j) + amat(k, j, i) * bvec(i)
    end do
  end do
end do
</code></pre>
<p>å¯ä»¥åœ¨æ•°ç»„ç»‘å®šä¸­é‡æ˜ å°„ï¼Œä»¥ä½¿ç”¨è¿ç»­æ•°ç»„åˆ‡ç‰‡ã€‚
å…è®¸å°†é«˜ç»´æ•°ç»„ç”¨ä½œä½ç»´æ•°ç»„ï¼Œè€Œä¸éœ€è¦é‡æ–°æ ¼å¼åŒ–æ•°ç»„ï¼Œ
è¿™æ ·é¿å…äº†æœ‰å¯èƒ½åˆ›å»ºä¸´æ—¶æ•°ç»„ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨çŸ©é˜µå‘é‡æ“ä½œæ¥ç¼©å¹¶ä¸‰ç»´æ•°ç»„çš„ç¬¬ä¸‰ç»´:</p>
<pre><code class="language-fortran">subroutine matmul312(amat, bvec, cmat)
  real(dp), contiguous, intent(in), target :: amat(:, :, :)
  real(dp), intent(in) :: bvec(:)
  real(dp), contiguous, intent(out), target :: cmat(:, :)
  real(dp), pointer :: aptr(:, :)
  real(dp), pointer :: cptr(:)

  aptr(1:size(amat, 1)*size(amat, 2), 1:size(amat, 3)) =&gt; amat
  cptr(1:size(cmat)) =&gt; cmat

  cptr = matmul(aptr, bvec)
end subroutine matmul312
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="é€å…ƒæ“ä½œ"><a class="header" href="#é€å…ƒæ“ä½œ">é€å…ƒæ“ä½œ</a></h1>
<p>å½“ä½¿ç”¨å­ä¾‹ç¨‹å’Œå‡½æ•°æ—¶ï¼Œæœ‰ä¸‰ç§æ–¹æ³•å¯ä»¥åœ¨æ•°ç»„ä¸Šæ‰§è¡Œé€å…ƒæ“ä½œ:</p>
<ul>
<li><code>elemental</code> è¿‡ç¨‹ï¼›</li>
<li><em>æ˜¾å¼å½¢çŠ¶</em> æ•°ç»„ï¼›</li>
<li>å®ç°å‘é‡çš„æ“ä½œï¼Œå¹¶å¯¹ä¸åŒçš„ç»´åº¦ç¼–å†™ç®€å•çš„åŒ…è£…å™¨ï¼ˆå†…éƒ¨ä½¿ç”¨<code>reshape</code>å®ç°ï¼‰ã€‚</li>
</ul>
<p>åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œä½¿ç”¨<code>elemental</code>å…³é”®å­—åˆ›å»ºè¿™æ ·çš„å‡½æ•°:</p>
<pre><code class="language-fortran">real(dp) elemental function nroot(n, x) result(y)
  integer, intent(in) :: n
  real(dp), intent(in) :: x
  y = x**(1._dp / n)
end function nroot
</code></pre>
<p>æ‰€æœ‰å‚æ•°ï¼ˆ<code>in</code>å’Œ<code>out</code>ï¼‰å¿…é¡»æ˜¯æ ‡é‡ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å¯¹ä»»ä½•ï¼ˆå…¼å®¹çš„ï¼‰å½¢çŠ¶çš„æ•°ç»„ä½¿ç”¨æ­¤å‡½æ•°ï¼Œ</p>
<pre><code class="language-fortran">print *, nroot(2, 9._dp)
print *, nroot(2, [1._dp, 4._dp, 9._dp, 10._dp])
print *, nroot(2, reshape([1._dp, 4._dp, 9._dp, 10._dp], [2, 2]))
print *, nroot([2, 3, 4, 5], [1._dp, 4._dp, 9._dp, 10._dp])
print *, nroot([2, 3, 4, 5], 4._dp)
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼Œ</p>
<pre><code class="language-fortran">3.0000000000000000
1.0000000000000000        2.0000000000000000        3.0000000000000000        3.1622776601683795
1.0000000000000000        2.0000000000000000        3.0000000000000000        3.1622776601683795
1.0000000000000000        1.5874010519681994        1.7320508075688772        1.5848931924611136
2.0000000000000000        1.5874010519681994        1.4142135623730951        1.3195079107728942
</code></pre>
<p>å¦‚ä¸Šï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œ<code>n</code>æ˜¯ä¸€ä¸ªå‚æ•°ï¼Œè€Œ<code>x</code>æ˜¯ä¸€ä¸ªä»»æ„å½¢çŠ¶çš„æ•°ç»„ã€‚
ä½†æ˜¯å¦‚æ‚¨æ‰€è§ï¼Œåªè¦æœ€ç»ˆçš„æ“ä½œæ˜¯æœ‰æ„ä¹‰çš„ï¼ˆå³å¦‚æœä¸€ä¸ªå‚æ•°æ˜¯æ•°ç»„ï¼Œ
é‚£ä¹ˆå…¶ä»–çš„å‚æ•°å¿…é¡»æ˜¯ç›¸åŒçš„å½¢çŠ¶çš„æ•°ç»„æˆ–æ ‡é‡ï¼‰ï¼ŒFortranå¹¶ä¸åœ¨ä¹å…¶å½¢å¼ã€‚
å¦‚æœä¸æ»¡è¶³ï¼Œé‚£ä¹ˆå°†å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚</p>
<p><code>elemental</code>å…³é”®å­—é€šå¸¸æ„å‘³ç€<code>pure</code>å…³é”®å­—ï¼Œå› æ­¤è¿‡ç¨‹å¿…é¡»æ˜¯çº¯çš„ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚
æ‚¨å¯ä»¥æ·»åŠ  <code>impure</code> å…³é”®å­—æ¥å–æ¶ˆè¿™ä¸€é™åˆ¶ï¼Œ</p>
<pre><code class="language-fortran">impure elemental subroutine write_all(a)
  inetger, intent(in) :: a
  write(*,&quot;(g0)&quot;) a
end subroutine write_all
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å¯åˆ†é…æ•°ç»„"><a class="header" href="#å¯åˆ†é…æ•°ç»„">å¯åˆ†é…æ•°ç»„</a></h1>
<p><code>allocatable</code>å±æ€§ä¸ºå†…å­˜å¤„ç†æä¾›äº†å®‰å…¨çš„æ–¹å¼ï¼Œ
ä¸å…·æœ‰<code>pointer</code>å±æ€§çš„å˜é‡ç›¸æ¯”ï¼Œå…¶å†…å­˜æ˜¯è‡ªåŠ¨ç®¡ç†çš„ï¼Œ
ä¸€æ—¦å˜é‡è¶…å‡ºä½œç”¨åŸŸï¼Œå†…å­˜å°±ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚ 
ä½¿ç”¨<code>allocatable</code>å˜é‡å¯ä»¥æ¶ˆé™¤åœ¨åº”ç”¨ç¨‹åºä¸­äº§ç”Ÿå†…å­˜æ³„æ¼çš„å¯èƒ½æ€§ã€‚</p>
<p>å¯åˆ†é…æ•°ç»„å¯ä»¥åœ¨å­ä¾‹ç¨‹ä¸­ç”¨äºåˆ›å»ºä¸´æ—¶æˆ–å·¥ä½œæ•°ç»„ï¼Œ
ï¼Œè€Œè‡ªåŠ¨æ•°ç»„å¯èƒ½ä¼šç”±äºæ‰€éœ€ç©ºé—´å¤ªå¤§ä¸èƒ½æ”¾åœ¨æ ˆä¸­ã€‚</p>
<pre><code class="language-fortran">real(dp), allocatable :: temp(:)
allocate(temp(10))
</code></pre>
<p>åˆ†é…çŠ¶æ€å¯ä»¥ä½¿ç”¨<code>allocated</code>æ¥æ£€æŸ¥ï¼Œä»¥é¿å…æœªåˆå§‹åŒ–çš„è®¿é—®ã€‚</p>
<pre><code class="language-fortran">subroutine show_arr(arr)
  integer, allocatable, intent(in) :: arr(:)

  if (allocated(arr)) then
    print *, arr
  end if
end subroutine show_arr
</code></pre>
<p>è¦åœ¨ä¸€ä¸ªè¿‡ç¨‹ä¸­ä¼ é€’ä½¿ç”¨å¯åˆ†é…å˜é‡ï¼Œè™šå‚å¿…é¡»å¸¦æœ‰<code>allocatable</code>å±æ€§ã€‚
å¦‚æœä¸<code>intent(out)</code>ç»“åˆä½¿ç”¨ï¼Œé‚£ä¹ˆæ•°ç»„ä¼šåœ¨è¿›å…¥è¿™ä¸ªè¿‡ç¨‹ä¹‹å‰é‡Šæ”¾ã€‚</p>
<pre><code class="language-fortran">subroutine foo(lam)
  real(dp), allocatable, intent(out) :: lam(:)
  allocate(lam(5))
end subroutine foo
</code></pre>
<p>åˆ†é…ä¹‹åçš„æ•°ç»„å¯ä»¥åƒæ™®é€šæ•°ç»„ä¸€æ ·ä½¿ç”¨ï¼Œ</p>
<pre><code class="language-fortran">real(dp), allocatable :: lam(:)
call foo(lam)
</code></pre>
<p>å·²ç»åˆ†é…çš„æ•°ç»„åœ¨æ²¡æœ‰äº‹å…ˆé‡Šæ”¾çš„æƒ…å†µä¸‹ä¸èƒ½å†æ¬¡è¿›è¡Œåˆ†é…ã€‚
åŒæ ·ï¼Œåªèƒ½å¯¹å·²åˆ†é…çš„æ•°ç»„è¿›è¡Œé‡Šæ”¾ã€‚ é‡æ–°åˆ†é…æ•°ç»„ä½¿ç”¨å¦‚ä¸‹æ“ä½œï¼Œ</p>
<pre><code class="language-fortran">if (allocated(lam)) deallocate(lam)
allocate(lam(10))
</code></pre>
<p>å°†å·²åˆ†é…çš„æ•°ç»„ä¼ é€’ç»™è¿‡ç¨‹è™šå‚ä¸éœ€è¦<code>allocatable</code>å±æ€§ã€‚</p>
<pre><code class="language-fortran">subroutine show_arr(arr)
  integer, intent(in) :: arr(:)

  print *, arr
end subroutine show_arr

subroutine proc
  integer :: i
  integer, allocatable :: arr(:)

  allocate(arr(5))

  do i = 1, size(arr)
    arr(i) = 2*i + 1
  end do
  call show_arr(arr)
end subroutine proc
</code></pre>
<p>åœ¨ç¨‹åºä¸­ä¼ é€’æœªåˆ†é…çš„æ•°ç»„å°†å¯¼è‡´æ— æ•ˆçš„å†…å­˜è®¿é—®ã€‚
å¯åˆ†é…æ•°ç»„å¯ä»¥ä¼ é€’ç»™å¸¦<code>optional</code>å±æ€§çš„è™šå‚----å¦‚æœå®ƒä»¬æœªè¢«åˆ†é…ï¼Œ
åˆ™æ­¤å‚æ•°å®é™…ä¸Šå°†ä¸å­˜åœ¨ã€‚
<code>allocatable</code>å±æ€§ä¸ä»…é™äºæ•°ç»„ï¼Œè¿˜å¯ä»¥ä¸æ ‡é‡å…³è”ï¼Œ
å®ƒå¯ä»¥ä¸å¸¦<code>optional</code>å±æ€§çš„è™šå‚ç»“åˆä½¿ç”¨ã€‚</p>
<p>ä½¿ç”¨<code>move_alloc</code>å†…éƒ¨å­ç¨‹åºï¼Œå¯ä»¥åœ¨å¸¦æœ‰<code>allocatable</code>å±æ€§çš„æ•°ç»„ä¹‹é—´ç§»åŠ¨åˆ†é…å±æ€§ã€‚</p>
<pre><code class="language-fortran">subroutine resize(var, n)
  real(wp), allocatable, intent(inout) :: var(:)
  integer, intent(in), optional :: n
  integer :: this_size, new_size
  integer, parameter :: inital_size = 16

  if (allocated(var)) then
    this_size = size(var, 1)
    call move_alloc(var, tmp)
  else
    this_size = initial_size
  end if

  if (present(n)) then
    new_size = n
  else
    new_size = this_size + this_size/2 + 1
  end if

  allocate(var(new_size))

  if (allocated(tmp)) then
    this_size = min(size(tmp, 1), size(var, 1))
    var(:this_size) = tmp(:this_size)
  end if
end subroutine resize
</code></pre>
<p>æœ€åï¼Œåˆ†é…ä¸ä¼šä¸åˆå§‹åŒ–æ•°ç»„çš„å€¼ã€‚
æœªåˆå§‹åŒ–æ•°ç»„çš„å†…å®¹å¾ˆå¯èƒ½åªæ˜¯ä¹‹å‰åœ¨ç›¸åº”åœ°å€å¤„çš„ä»»ä½•å†…å®¹çš„å­—èŠ‚ã€‚
åˆ†é…æ—¶å¯ä»¥ä½¿ç”¨sourceè¿›è¡Œåˆå§‹åŒ–ï¼Œ</p>
<pre><code class="language-fortran">real(dp), allocatable :: arr(:)
allocate(arr(10), source=0.0_dp)
</code></pre>
<p><code>source</code>å…³é”®å­—æ”¯æŒæ ‡é‡ï¼Œæ•°ç»„å˜é‡å’Œå¸¸é‡ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="æ–‡ä»¶io"><a class="header" href="#æ–‡ä»¶io">æ–‡ä»¶io</a></h1>
<p>åœ¨Fortranä¸­ï¼Œæ–‡ä»¶ç”±<code>unit</code>å•å…ƒæ ‡è¯†ç¬¦ç®¡ç†ã€‚
ä¸æ–‡ä»¶ç³»ç»Ÿçš„äº¤äº’ä¸»è¦é€šè¿‡<code>open</code>å’Œ<code>inquire</code>å†…ç½®è¿‡ç¨‹è¿›è¡Œã€‚
é€šå¸¸ï¼Œå·¥ä½œæµæ˜¯æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åˆ°ä¸€ä¸ªå•å…ƒæ ‡è¯†ç¬¦ï¼Œè¯»å’Œï¼ˆæˆ–ï¼‰å†™ï¼Œç„¶åå†å…³é—­å®ƒã€‚</p>
<pre><code class="language-fortran">integer :: io
open(newunit=io, file=&quot;log.txt&quot;)
! ...
close(io)
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœæ–‡ä»¶è¿˜ä¸å­˜åœ¨ï¼Œå¹¶ä¸”ä¸ºåŒæ—¶å…·æœ‰è¯»å’Œå†™æ“ä½œçš„æ–‡ä»¶ï¼Œ
é‚£ä¹ˆå°†ä¼šåˆ›å»ºè¯¥æ–‡ä»¶ã€‚
å†™å…¥ç°æœ‰æ–‡ä»¶å°†ä»ç¬¬ä¸€ä¸ªè®°å½•ï¼ˆå³ç¬¬ä¸€è¡Œï¼‰å¼€å§‹ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ä¼šè¦†ç›–æ–‡ä»¶ã€‚</p>
<p>è¦å¯¹æ–‡ä»¶çš„è¿›è¡Œåªè¯»è®¿é—®ï¼Œå¿…é¡»æŒ‡å®š<code>status</code>å’Œ<code>action</code>ï¼Œ</p>
<pre><code class="language-fortran">integer :: io
open(newunit=io, file=&quot;log.txt&quot;, status=&quot;old&quot;, action=&quot;read&quot;)
read(io, *) a, b
close(io)
</code></pre>
<p>å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿè¿è¡Œæ—¶é”™è¯¯ã€‚
è¦åœ¨æ‰“å¼€æ–‡ä»¶ä¹‹å‰æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¯ä»¥ä½¿ç”¨ <code>inquire</code>å‡½æ•°ã€‚</p>
<pre><code class="language-fortran">logical :: exists
inquire(file=&quot;log.txt&quot;, exist=exists)
if (exists) then
  ! ...
end if
</code></pre>
<p>æˆ–è€…ï¼Œä½¿ç”¨<code>open</code>è¿‡ç¨‹å¯ä»¥è¿”å›ä¸€ä¸ªå¯é€‰çš„<em>iostat</em>å’Œ<em>iomsg</em>:</p>
<pre><code class="language-fortran">integer :: io, stat
character(len=512) :: msg
open(newunit=io, file=&quot;log.txt&quot;, status=&quot;old&quot;, action=&quot;read&quot;, &amp;
  iostat=stat, iomsg=msg)
if (stat /= 0) then
  print *, trim(msg)
end if
</code></pre>
<p>æ³¨æ„ï¼Œ<em>iomsg</em>éœ€è¦ä¸€ä¸ªå›ºå®šé•¿åº¦çš„å­—ç¬¦å˜é‡ï¼Œå®ƒåº”å½“æœ‰è¶³å¤Ÿçš„é•¿åº¦æ¥ä¿å­˜é”™è¯¯ä¿¡æ¯ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œä½¿ç”¨<em>status</em>å’Œ<em>action</em>å…³é”®å­—åˆ›å»ºä¸€ä¸ªå†™å…¥æ–‡ä»¶ã€‚
å¦‚ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„å†™å…¥æ–‡ä»¶ï¼Œ</p>
<pre><code class="language-fortran">integer :: io
open(newunit=io, file=&quot;log.txt&quot;, status=&quot;new&quot;, action=&quot;write&quot;)
write(io, *) a, b
close(io)
</code></pre>
<p><code>status=&quot;replace&quot;</code>å¯ä»¥ç”¨äºè¦†ç›–ç°æœ‰æ–‡ä»¶ã€‚
å¼ºçƒˆå»ºè®®åœ¨ä½¿ç”¨<em>status</em>ä¹‹å‰ï¼Œé¦–å…ˆæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚</p>
<p>è¦è¿½åŠ åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å®š<em>position</em>å…³é”®å­—ï¼Œ</p>
<pre><code class="language-fortran">integer :: io
open(newunit=io, file=&quot;log.txt&quot;, position=&quot;append&quot;, &amp;
  &amp; status=&quot;old&quot;, action=&quot;write&quot;)
write(io, *) size(v)
write(io, *) v(:)
close(io)
</code></pre>
<p>è¦é‡ç½®æ–‡ä»¶ä¸­çš„ä½ç½®ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½®è¿‡ç¨‹<code>rewind</code>å’Œ<code>backspace</code>ã€‚
<code>rewind</code>å°†é‡ç½®ä¸ºç¬¬ä¸€ä¸ªè®°å½•ï¼ˆè¡Œï¼‰ï¼Œè€Œ<code>backspace</code>å°†è¿”å›åˆ°å‰ä¸€ä¸ªè®°å½•ï¼ˆè¡Œï¼‰ã€‚</p>
<p>æœ€åï¼Œè¦åˆ é™¤æ–‡ä»¶ï¼Œæ–‡ä»¶å¿…é¡»è¦æ‰“å¼€ï¼Œå¹¶å¯ä»¥åœ¨å…³é—­ååˆ é™¤ã€‚</p>
<pre><code class="language-fortran">logical :: exists
integer :: io, stat
inquire(file=&quot;log.txt&quot;, exist=exists)
if (exists) then
  open(file=&quot;log.txt&quot;, newunit=io, iostat=stat)
  if (stat == 0) close(io, status=&quot;delete&quot;, iostat=stat)
end if
</code></pre>
<p>ä¸€ä¸ªæœ‰ç”¨çš„IOåŠŸèƒ½æ˜¯æš‚å­˜æ–‡ä»¶ï¼Œå®ƒå¯ä»¥ç”¨<code>status=&quot;scratch&quot;</code>æ‰“å¼€ã€‚ 
å…³é—­å•å…ƒæ ‡è¯†ç¬¦åï¼Œå®ƒå°†è‡ªåŠ¨åˆ é™¤ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="å›è°ƒå‡½æ•°"><a class="header" href="#å›è°ƒå‡½æ•°">å›è°ƒå‡½æ•°</a></h1>
<p>å›è°ƒå‡½æ•°æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°çš„å‡½æ•°ã€‚
åˆ›å»ºæ­¤ç±»å›è°ƒå‡½æ•°çš„é¦–é€‰æ–¹æ³•æ˜¯æä¾›<em>æŠ½è±¡æ¥å£</em> ï¼ˆabstract interfaceï¼‰å£°æ˜å›è°ƒå‡½æ•°çš„ç‰¹å¾ã€‚
è¿™æ ·å¯ä»¥å¯¹ä¼ é€’çš„å›è°ƒå‡½æ•°è¿›è¡Œç¼–è¯‘æ—¶æ£€æŸ¥ã€‚</p>
<pre><code class="language-fortran">module integrals
  use types, only: dp
  implicit none
  private
  public :: simpson, integrable_function

  abstract interface
    function integrable_function(x) result(func)
      import :: dp
      real(dp), intent(in) :: x
      real(dp) :: func
    end function integrable_function
  end interface

contains

  function simpson(f, a, b) result(s)
    real(dp), intent(in) :: a, b
    procedure(integrable_function) :: f
    real(dp) :: s

    s = (b-a) / 6 * (f(a) + 4*f((a+b)/2) + f(b))
  end function simpson

end module integrals
</code></pre>
<p>ç„¶åï¼Œé€šè¿‡å¯¼å…¥æ¨¡å—ï¼Œè¯¥å‡½æ•°å°†ä½œä¸ºå›è°ƒå‡½æ•°ä½¿ç”¨ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œ</p>
<pre><code class="language-fortran">module demo_functions
  use types, only: dp
  implicit none
  private
  public :: test_integral

contains

  subroutine test_integral(a, k)
    real(dp), intent(in) :: a, k

    print *, simpson(f, 0._dp, pi)
    print *, simpson(f, 0._dp, 2*pi)
  contains

    function f(x) result(y)
      real(dp), intent(in) :: x
      real(dp) :: y
      y = a*sin(k*x)
    end function f
  end subroutine test_integral

end module demo_functions
</code></pre>
<p>å¦‚æœå¯¼å‡ºæŠ½è±¡æ¥å£,å¯ä»¥åˆ›å»ºå…·æœ‰æ­£ç¡®ç‰¹å¾çš„è¿‡ç¨‹æŒ‡é’ˆï¼Œ
è¿˜å¯ä»¥è¿›ä¸€æ­¥æ‰©å±•å›è°ƒå‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</p>
<pre><code class="language-fortran">module demo_integrals
  use types, only: dp
  use integrals, only: simpson, integrable_function
  implicit none
  private
  public :: simpson2, integrable_function

contains

  function simpson2(f, a, b) result(s)
    real(dp), intent(in) :: a, b
    procedure(integrable_function) :: f
    real(dp) :: s
    real(dp) :: mid
    mid = (a + b)/2
    s = simpson(f, a, mid) + simpson(f, mid, b)
  end function simpson2

end module demo_integrals
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åœ¨windowsç³»ç»Ÿä¸‹è¿›è¡Œfortranç¼–ç¨‹"><a class="header" href="#åœ¨windowsç³»ç»Ÿä¸‹è¿›è¡Œfortranç¼–ç¨‹">åœ¨Windowsç³»ç»Ÿä¸‹è¿›è¡ŒFortranç¼–ç¨‹</a></h1>
<p>è¯¥ç¯‡ç« å°†ç€é‡è®²è¿°æˆ‘ä»¬åœ¨Windowsä¸‹ç¼–ç¨‹è¿›è¡ŒFortranç¼–ç¨‹ã€‚</p>
<h2 id="gfortranç¯‡"><a class="header" href="#gfortranç¯‡">GFortranç¯‡</a></h2>
<p>åœ¨Windowsç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬æ¨èMSYS2-GFortranï¼ŒåŸå› æ˜¯MSYS2åŸºäºpacmanåŒ…ç®¡ç†æ»šåŠ¨æ›´æ–°ï¼Œæ‹¥æœ‰ä¸°å¯Œçš„å¼€å‘å·¥å…·é›†ä¸”ä½¿ç”¨ç®€å•ï¼Œè¿™å¾€å¾€é€‚ç”¨äºæå®¢ã€çˆ±å¥½è€…ã€‚<br>
å¦‚æœä½ å¯¹ç¼–ç¨‹ç¯å¢ƒçš„ç¨³å®šæ€§éœ€æ±‚å¾ˆé«˜ï¼Œä½ å¯ä»¥å‰å¾€<a href="http://www.equation.com/">equation.com</a>æˆ–è€…<a href="https://winlibs.com/">winlibs.com</a>ï¼ˆä¸€äº›å›½å¤–ç½‘ç«™å¯èƒ½æ— æ³•è®¿é—®ï¼‰ä¸‹è½½å›ºå®šç‰ˆæœ¬å·çš„Mingw-w64-GCCç¼–ç¨‹å¥—ä»¶ï¼Œ
æˆ–è€…ä½¿ç”¨<a href="https://software.intel.com/content/www/us/en/develop/tools/oneapi/all-toolkits.html">Intel OneAPI</a>å¥—ä»¶ã€‚<br>
å¦‚æœä½ å¯¹åŸç”Ÿç¼–ç¨‹å·¥å…·é›†æœ‰éœ€æ±‚ï¼Œæˆ–è€…Mingwç¯å¢ƒå‡ºç°äº†BUGï¼Œä½ å¯ä»¥è¯•ç€å®‰è£…<a href="https://docs.microsoft.com/zh-cn/windows/wsl/setup/environment">WSL2</a>ã€‚</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="åœ¨windowsç³»ç»Ÿä¸‹ä½¿ç”¨gfortran"><a class="header" href="#åœ¨windowsç³»ç»Ÿä¸‹ä½¿ç”¨gfortran">åœ¨Windowsç³»ç»Ÿä¸‹ä½¿ç”¨GFortran</a></h1>
<p>å¾®è½¯å…¬å¸å¼€å‘çš„Windowsç³»ç»Ÿå…·æœ‰å¼ºå¤§çš„å›¾å½¢ç”¨æˆ·ç•Œé¢ğŸ¨ï¼Œæ˜¯æˆ‘ä»¬å¸¸ç”¨çš„æ“ä½œç³»ç»Ÿã€‚<br>
GCC Fortranç¼–è¯‘å™¨ï¼Œå¯¹Fortranæ–°æ ‡å‡†çš„æ”¯æŒéå¸¸åŠæ—¶ï¼Œæ˜¯ä¸€æ¬¾å…è´¹ğŸ»çš„å¼€æºè½¯ä»¶ã€‚</p>
<h2 id="ä½¿ç”¨msys2-gfortran"><a class="header" href="#ä½¿ç”¨msys2-gfortran">ä½¿ç”¨MSYS2-GFortran</a></h2>
<p>å¯ä»¥å°†MSYS2ç®€å•åœ°ç†è§£ä¸ºä¸€ä¸ªåŒ…ç®¡ç†å™¨ï¼Œé›†æˆäº†<code>pacman</code>å’Œ<a href="https://sourceforge.net/projects/mingw/"><code>Mingw-w64</code></a>ã€‚</p>
<h3 id="å®‰è£…msys2è½¯ä»¶"><a class="header" href="#å®‰è£…msys2è½¯ä»¶">å®‰è£…MSYS2è½¯ä»¶</a></h3>
<p>å‰å¾€<a href="https://www.msys2.org/">MSYS2é¡¹ç›®å®˜æ–¹ç½‘ç«™</a>ğŸ“¡ï¼Œç‚¹å‡»å›¾ç¤ºç®­å¤´æŒ‡å‘çš„é“¾æ¥ï¼Œä¸‹è½½MSYS2è½¯ä»¶ï¼Œé˜…è¯»ç½‘é¡µæä¾›çš„<a href="https://www.msys2.org/wiki/Home/">å®‰è£…æ•™ç¨‹è¿›è¡Œå®‰è£…å’Œä½¿ç”¨</a>ğŸ“œã€‚</p>
<img src="Fortran-Programming-in-Windows/images/MSYS2-Main-Page.png" alt="MSYS2ä¸»é¡µæˆªå›¾" style="zoom:50%;" />
<p>å½“æˆ‘ä»¬åœ¨ä½¿ç”¨MSYS2è½¯ä»¶çš„è¿‡ç¨‹ä¸­é‡åˆ°å›°éš¾æˆ–è€…è½¯ä»¶æ¼æ´æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘<a href="https://github.com/msys2/msys2.github.io/issues">MSYS2é¡¹ç›®çš„GitHubä»“åº“çš„è®®é¢˜</a>ğŸ¯å¯»æ±‚å¸®åŠ©ã€‚</p>
<h3 id="å®‰è£…msys2-gfortranè½¯ä»¶"><a class="header" href="#å®‰è£…msys2-gfortranè½¯ä»¶">å®‰è£…MSYS2-GFortranè½¯ä»¶</a></h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬ç†Ÿæ‚‰ä¸€ä¸‹MSYS2è½¯ä»¶çš„å‘½ä»¤è¡ŒåŸºç¡€æ“ä½œğŸ•¹ï¼Œè¿™åœ¨MSYS2é¡¹ç›®å®˜æ–¹æä¾›çš„æ–‡æ¡£ä¸­èƒ½æ‰¾åˆ°ï¼š</p>
<pre><code class="language-sh">pacman -Syu                  # å‡çº§msys2å†…éƒ¨ç»„ä»¶å’Œä»“åº“ä¿¡æ¯
pacman -Ss &lt;package_name&gt;    # æœç´¢è½¯ä»¶
pacman -S  &lt;package_name&gt;    # å®‰è£…è½¯ä»¶
pacman -Qs &lt;package_name&gt;    # æŸ¥è¯¢æœ¬åœ°å®‰è£…çš„ç‰¹å®šè½¯ä»¶
pacman -Rs &lt;package_name&gt;    # å¸è½½è½¯ä»¶
pacman -R --help             # æŸ¥è¯¢å‘½ä»¤çš„å¸®åŠ©æ–‡æ¡£
...
</code></pre>
<p>è¯·åŠ¡å¿…çµæ´»ğŸ“ä½¿ç”¨MSYS2è½¯ä»¶ï¼Œè¯¥è½¯ä»¶åœ¨è¿è¡Œå‰æœ‰ä¸€äº›ä¸ªæ€§åŒ–çš„é…ç½®æ–‡ä»¶å¯ä»¥è®¾ç½®ï¼Œå½“ç„¶ä¿æŒé»˜è®¤ä¹Ÿæ˜¯ä¸é”™çš„ã€‚<br>ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼åœ¨MSYS2è½¯ä»¶ä¸­å®‰è£…GFortranï¼š</p>
<pre><code class="language-sh">pacman -Ss fortran           # æŸ¥è¯¢åå­—ä¸­å«â€œFortranâ€å­—ç¬¦çš„åŒ…
pacman -S  ucrt64/mingw-w64-ucrt-x86_64-gcc-fortran    # å®‰è£…ucrt64ç‰ˆæœ¬çš„gfortran
</code></pre>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨MSYS2è½¯ä»¶ï¼Œä¸‹è½½<code>GNU Make/CMake/openBLAS/Python/Golang/...</code>ç­‰ä¸°å¯Œçš„è½¯ä»¶æˆ–è€…é“¾æ¥åº“ã€‚GCC WIKIä¸ºæˆ‘ä»¬æä¾›äº†<a href="https://gcc.gnu.org/wiki/GFortran">ä¸€äº›GFortrançš„ä¿¡æ¯æ–‡æ¡£</a>ï¼Œå…¶ä¸­å°±æœ‰<a href="https://gcc.gnu.org/onlinedocs/gfortran.pdf">GFortranæœ€æ–°çš„å¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<pre><code class="language-sh">gfortran &lt;name&gt;.f90          # ç¼–è¯‘fortranæºä»£ç æ–‡ä»¶
gfortran --help              # æŸ¥è¯¢gfortranå‘½ä»¤è¡Œå‚æ•°çš„å¸®åŠ©æ–‡æ¡£
...
</code></pre>
<p>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ›´æ”¹MSYS2è½¯ä»¶çš„å®‰è£…è·¯å¾„ï¼Œåˆ™å®‰è£…çš„GFortranè½¯ä»¶åº”è¯¥æ˜¯åœ¨<code>C:\msys64</code>è·¯å¾„ä¸‹çš„ç‰¹å®šç¯å¢ƒçš„å­æ–‡ä»¶ä¸‹ï¼Œæˆ‘ä»¬æœ€å¥½å°†å®ƒå¼•å…¥åˆ°Windowsè½¯ä»¶çš„çš„ç¯å¢ƒè·¯å¾„ğŸ”—ä¸­ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨å®ƒï¼ˆgfortran.exeï¼‰ã€‚ä¾‹å¦‚è·¯å¾„ï¼Œ</p>
<pre><code class="language-sh">C:/msys64/ucrt64/bin         # äºŒè¿›åˆ¶çš„å¯æ‰§è¡Œç¨‹åºæ‰€åœ¨è·¯å¾„
C:/msys64/ucrt64/lib         # å¯æ‰§è¡Œç¨‹åºçš„åŠ¨æ€é“¾æ¥åº“ä¾èµ–æ‰€åœ¨è·¯å¾„
</code></pre>
<blockquote>
<p>ğŸ”° è¿™é‡Œé»˜è®¤æˆ‘ä»¬ç°åœ¨å¤§å¤šæ•°ä½¿ç”¨çš„ç¡¬ä»¶æ˜¯64ä½çš„ï¼Œä¸”ä½¿ç”¨è¾ƒæ–°çš„MSYS2ç¯å¢ƒï¼ˆUCRTï¼‰ï¼Œæœ‰ä¸ªæ€§åŒ–éœ€æ±‚å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ã€‚</p>
</blockquote>
<h2 id="ä½¿ç”¨visul-studio-codeç¼–è¾‘å™¨è¿›è¡Œç¼–ç "><a class="header" href="#ä½¿ç”¨visul-studio-codeç¼–è¾‘å™¨è¿›è¡Œç¼–ç ">ä½¿ç”¨Visul Studio Codeç¼–è¾‘å™¨è¿›è¡Œç¼–ç </a></h2>
<p><a href="https://code.visualstudio.com/">Visual Studio Codeï¼ˆç®€ç§°ï¼ŒVS Codeæˆ–codeï¼‰</a>æ˜¯ä¸€æ¬¾ç”±å¾®è½¯å…¬å¸ä¸»å¯¼çš„å…è´¹å¼€æºã€é€æ¸å¼ºå¤§çš„ä»£ç ç¼–è¾‘å™¨è½¯ä»¶ã€‚<br>
åˆæ¬¡ä½¿ç”¨VS Codeç¼–è¾‘å™¨ï¼Œå¯ä»¥å°è¯•é˜…è¯»<a href="https://code.visualstudio.com/docs">VS Codeå¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<h3 id="æ¨èçš„vs-codeæ’ä»¶"><a class="header" href="#æ¨èçš„vs-codeæ’ä»¶">æ¨èçš„VS Codeæ’ä»¶</a></h3>
<p>é’ˆå¯¹Fortranç¼–ç¨‹ï¼Œæˆ‘ä»¬æœ‰ä¸€äº›å¯ä»¥æ–¹ä¾¿ç‰¹å®šç¼–ç¨‹éœ€æ±‚çš„æ’ä»¶ğŸ› ï¼Œè¢«åˆ—å‡ºæ¥ä»…ä¾›å‚è€ƒï¼š</p>
<pre><code class="language-markdown">+ ä¸­æ–‡è½¯ä»¶åŒ…æ’ä»¶
+ Modern Fortran
+ Fortran IntelliSense
+ GDB Debugger - Beyond
+ VSCode Great Icons (å¯é€‰)
+ Better TOML (å¯é€‰)
</code></pre>
<h3 id="æ¨èçš„ç¼–ç¨‹æ ·å¼"><a class="header" href="#æ¨èçš„ç¼–ç¨‹æ ·å¼">æ¨èçš„ç¼–ç¨‹æ ·å¼</a></h3>
<p>ä¸ºäº†æé«˜ä»£ç çš„å¯è¯»æ€§ğŸ’¡ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å•å…ƒç¼–ç¨‹æ ·å¼ï¼š</p>
<pre><code class="language-fortran">!&gt; ç›¸åŠ 
subroutine add(x, y, z)
    
    real, intent(in)  :: x, y
    real, intent(out) :: z     !! è¿”å›å€¼
    
    !&gt; åŠ æ³•
    z = x + y
    
end subroutine add
</code></pre>
<p>åœ¨åŒºå—ä»£ç å‰ä½¿ç”¨<code>!&gt;</code>æ³¨é‡Šæ ‡å¤´ä½¿å¾—VS Codeçš„Fortranæ’ä»¶èƒ½è§£ææ³¨é‡Šï¼›åœ¨å•è¡Œæ³¨é‡Šæ—¶ï¼Œæœ‰å“ä½åœ°ä½¿ç”¨<code>!&gt;</code>æˆ–<code>!!</code>å¯ä»¥æé«˜ä»£ç çš„å¯è¯»æ€§ã€‚</p>
<blockquote>
<p><code>!&gt;</code>æ³¨é‡Šæ ‡å¤´è¢«<a href="https://github.com/fortran-lang">Fortran-Langç»„ç»‡</a>ä¸<a href="https://fortran-lang.discourse.group/">ç¤¾åŒº</a>å¹¿æ³›ä½¿ç”¨ã€‚</p>
</blockquote>
<h3 id="ä½¿ç”¨fpmæ„å»ºfortranä»£ç "><a class="header" href="#ä½¿ç”¨fpmæ„å»ºfortranä»£ç ">ä½¿ç”¨FPMæ„å»ºFortranä»£ç </a></h3>
<p><a href="https://github.com/fortran-lang/fpm">Fortran Package Managerï¼ˆFPMï¼‰</a>æ˜¯Fortran-Langç»„ç»‡ä¸»å¯¼ã€ä¸ºFortranè¯­è¨€ä¸“é—¨å®šåˆ¶å¼€å‘çš„å…è´¹ã€å¼€æºçš„åŒ…ç®¡ç†å™¨å’Œæ„å»ºç³»ç»Ÿã€‚</p>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨MSYS2è½¯ä»¶æ¥å®‰è£…FPMï¼Œä¹Ÿå¯ä»¥å‰å¾€<a href="https://github.com/fortran-lang/fpm">Fortran Package Manager (fpm) (github.com)</a>ä»“åº“æ‰‹åŠ¨ç¼–è¯‘å‡ºå¯æ‰§è¡Œç¨‹åºFPMï¼Œå±Šæ—¶åŠ¡å¿…é˜…è¯»ä»“åº“æä¾›çš„å¸®åŠ©æ–‡æ¡£<a href="https://github.com/fortran-lang/fpm#readme"><code>README.md</code></a>ã€‚åˆ«å¿˜äº†å°†æ‰‹åŠ¨ç¼–è¯‘çš„FPMå¼•å…¥Windowsè½¯ä»¶çš„çš„ç¯å¢ƒè·¯å¾„ğŸ”—ä¸­ï¼Œä»¥æ–¹ä¾¿æˆ‘ä»¬ä½¿ç”¨å®ƒï¼ˆfpm.exeï¼‰ã€‚</p>
<pre><code class="language-sh">pacman -Ss fpm              # æŸ¥è¯¢åå­—ä¸­å«â€œfpmâ€å­—ç¬¦çš„åŒ…
pacman -S ucrt64/mingw-w64-ucrt-x86_64-fpm  # å®‰è£…fpmè½¯ä»¶
</code></pre>
<p><strong>æˆ‘ä»¬æ¥æ¼”ç¤ºä¸€ä¸ªFPMé¡¹ç›®çš„åˆå§‹åŒ–ã€ç¼–å†™ã€æ„å»ºã€è¿è¡Œï¼š</strong></p>
<p>æˆ‘ä»¬å¯ä»¥æ­é…å‘½ä»¤è¡Œå·¥å…·ï¼ˆpwshã€bashï¼‰ä½¿ç”¨FPMï¼Œä¹Ÿå¯ä»¥åœ¨VS Codeæ‰“å¼€hello_worldæ–‡ä»¶å¤¹ï¼Œ<strong>æ­¤åæˆ‘ä»¬å°±å¯ä»¥ä¸“å¿ƒç¼–å†™ä»£ç äº†</strong>ğŸ’»ã€‚</p>
<pre><code class="language-sh">fpm new hello_world &amp;&amp; cd hello_world       # æ–°å»ºFPMé¡¹ç›®å¹¶åˆ‡æ¢åˆ°æ–‡ä»¶å¤¹ä¸‹: hello_world
fpm build                   # ç¼–è¯‘FPMé¡¹ç›®
fpm run                     # è¿è¡Œä¸»ç¨‹åºğŸš€
fpm test --help             # è·å–ç‰¹å®šå‘½ä»¤è¡Œå‚æ•°çš„å¸®åŠ©æ–‡æ¡£
code .                      # ä½¿ç”¨VS Codeæ‰“å¼€å½“å‰æ–‡ä»¶å¤¹
...
</code></pre>
<img src="Fortran-Programming-in-Windows/images/hello_world-in-code.png" alt="ä½¿ç”¨VS Codeç¼–è¾‘hello_worldé¡¹ç›®" style="zoom:75%;" />
<p>ä½œä¸ºç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥é˜…è¯»ğŸ”<a href="https://fpm.fortran-lang.org/page/Packaging.html"><code>Packaging with fpm</code></a>å’Œ<a href="https://fpm.fortran-lang.org/page/Manifest.html"><code>Manifest reference</code></a>ï¼›å¦‚æœæˆ‘ä»¬æƒ³æˆä¸ºFPMçš„è´¡çŒ®è€…å’Œå¼€å‘è€…ï¼Œé˜…è¯»<a href="https://fpm.fortran-lang.org/index.html#fortran-package-manager-developer-documentation">FPMå¼€å‘è€…æ–‡æ¡£</a>å°†æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>
<h3 id="ä½¿ç”¨cmakeæ„å»ºä»£ç å¯é€‰"><a class="header" href="#ä½¿ç”¨cmakeæ„å»ºä»£ç å¯é€‰">ä½¿ç”¨CMakeæ„å»ºä»£ç ï¼ˆå¯é€‰ï¼‰</a></h3>
<p>CMakeæ˜¯ä¸€æ¬¾å…è´¹ã€å¼€æºã€ä¼˜ç§€çš„ä»£ç æ„å»ºç³»ç»Ÿï¼Œå®ƒçš„è·¨å¹³å°èƒ½åŠ›å¾ˆå¼ºã€æ”¯æŒå¤šç¼–è¯‘å™¨ï¼ŒåŠŸèƒ½å¼ºå¤§åŒæ—¶ä¹Ÿå…·æœ‰ä¸€å®šéš¾åº¦ã€‚<br>
æˆ‘ä»¬å¯ä»¥å‰å¾€<a href="https://cmake.org/">CMakeå®˜æ–¹ç½‘ç«™</a>é˜…è¯»<a href="https://cmake.org/documentation/">å¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<pre><code class="language-sh">pacman -Ss cmake            # æŸ¥è¯¢åå­—ä¸­å«â€œcmakeâ€å­—ç¬¦çš„åŒ…
pacman -S  ucrt64/mingw-w64-ucrt-x86_64-cmake   # å®‰è£…CMakeè½¯ä»¶
cmake  --help               # è·å–cmakeå‘½ä»¤è¡Œå‚æ•°çš„å¸®åŠ©æ–‡æ¡£
</code></pre>
<h4 id="å•ä¸ªæºæ–‡ä»¶ä»£ç "><a class="header" href="#å•ä¸ªæºæ–‡ä»¶ä»£ç ">å•ä¸ªæºæ–‡ä»¶ä»£ç </a></h4>
<p>CMakeä½¿ç”¨é…ç½®æ–‡ä»¶æ¥æ„å»ºæˆ‘ä»¬çš„ä»£ç ï¼Œå¦‚<code>CMakelists.txt</code>ã€‚å‡è®¾æˆ‘ä»¬æƒ³æ„å»ºä¸€ä¸ªâ€œHello Fortranâ€ä»£ç ï¼Œåœ¨<code>hello_fortran.f90</code>åŒä¸€æ–‡ä»¶å¤¹ä¸‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>CMakelists.txt</code>ï¼š</p>
<pre><code class="language-cmake">cmake_minimum_required(VERSION 3.0)                     # è®¾ç½®è¦ä½¿ç”¨CMakeçš„æœ€å°ç‰ˆæœ¬ï¼Œæ­¤å¤„å–ä¸º3.0

project(fortran_basics LANGUAGES Fortran)               # è®¾ç½®å·¥ç¨‹çš„åå­—ä¸ºfortran_basicsï¼Œå’Œç¼–è¯‘å·¥ç¨‹çš„ç¼–ç¨‹è¯­è¨€ä¸ºFortran

set(CMAKE_Fortran_MODULE_DIRECTORY
    ${CMAKE_BINARY_DIR}/modules)
file(MAKE_DIRECTORY ${CMAKE_Fortran_MODULE_DIRECTORY})  # è®¾ç½®ç¼–è¯‘å™¨ç¼–è¯‘ä»£ç ç”Ÿæˆçš„*.modæ–‡ä»¶è¢«å‚¨å­˜åœ¨ç›®æ ‡æ„å»ºæ–‡ä»¶å¤¹ä¸‹

add_compile_options(-Wall -Wextra)                      # è®¾ç½®é¢å¤–çš„ç¼–è¯‘å™¨é€‰é¡¹ï¼ˆå‘½ä»¤è¡Œå‚æ•°ï¼‰ï¼Œæ­¤å¤„ä¸º`-Wall -Wextra`

add_executable(hello_fortran.exe hello_fortran.f90)     # è®¾ç½®å…·ä½“çš„ç¼–è¯‘å†…å®¹ï¼Œæ­¤å¤„è®¾ç½®å°†hello_fortran.f90ç¼–è¯‘æˆhello_fortran.exe
</code></pre>
<p>å½“æˆ‘ä»¬ç¼–è¯‘ä»£ç æ—¶ï¼ŒCMakeä¼šç”Ÿæˆå¾ˆå¤šå…·ä½“çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å°†å®ƒä»¬ç”Ÿæˆåœ¨ä¸€ä¸ªå«åš<code>build</code>çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œä»¥ä¿æŒæ•´é½çš„æ–‡ä»¶å¤¹å†…å®¹ã€‚</p>
<pre><code class="language-sh">mkdir build &amp;&amp; cd build     # æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`build`ï¼Œå¹¶åˆ‡æ¢åˆ°è¯¥æ–‡ä»¶å¤¹
cmake -G &quot;MSYS Makefiles&quot; ..    # CMakeæ ¹æ®å‘½ä»¤è¡Œå‚æ•°`-G &quot;MSYS Makefiles&quot; ..`å’ŒCMakelists.txtçš„ä¿¡æ¯ç”Ÿæˆmakefiles
make                        # ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨makeæ¥ç¼–è¯‘ä»£ç äº†
./hello_fortran.exe         # ç¼–è¯‘æˆåŠŸï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä»£ç äº†
</code></pre>
<img src="Fortran-Programming-in-Windows/images/CMake-hello_fortran.png" alt="åœ¨VS Codeä¸­ä½¿ç”¨CMake" style="zoom:75%;" />
<h4 id="å¤šä¸ªæºä»£ç æ–‡ä»¶"><a class="header" href="#å¤šä¸ªæºä»£ç æ–‡ä»¶">å¤šä¸ªæºä»£ç æ–‡ä»¶</a></h4>
<pre><code class="language-cmake">add_executable(hello_fortran.exe 
    hello_fortran.f90
    print_stars.f90)  # æˆ‘ä»¬éœ€è¦æ›´æ–°CMakelists.txtä¸­å…·ä½“çš„ç¼–è¯‘å†…å®¹ï¼Œå¢åŠ print_stars.f90ç¼–è¯‘åˆ°hello_fortran.exe
</code></pre>
<img src="Fortran-Programming-in-Windows/images/CMake-hello_fortran2.png" alt="åœ¨VS Codeä¸­ä½¿ç”¨CMake" style="zoom:75%;" />
<h2 id="ä½¿ç”¨vs-codeè¿›è¡Œä»£ç è°ƒè¯•"><a class="header" href="#ä½¿ç”¨vs-codeè¿›è¡Œä»£ç è°ƒè¯•">ä½¿ç”¨VS Codeè¿›è¡Œä»£ç è°ƒè¯•</a></h2>
<p>è°ƒè¯•çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯<code>write</code>åˆ°å±å¹•æˆ–æ–‡ä»¶ä¸­ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨GDBç±»çš„è½¯ä»¶æ¥è°ƒè¯•ã€‚</p>
<h3 id="ä½¿ç”¨gdbæ¥è°ƒè¯•ä»£ç "><a class="header" href="#ä½¿ç”¨gdbæ¥è°ƒè¯•ä»£ç ">ä½¿ç”¨GDBæ¥è°ƒè¯•ä»£ç </a></h3>
<p>GDBæ˜¯GNUå¼€æºçš„Debugå…è´¹è½¯ä»¶ï¼Œå¯ä»¥å‰å¾€<a href="https://www.gnu.org/software/gdb/">GDBå®˜ç½‘</a>
ä¸‹è½½<a href="https://sourceware.org/gdb/download/onlinedocs/gdb.pdf">å¸®åŠ©æ–‡æ¡£</a>ã€‚</p>
<pre><code class="language-sh">pacman -Ss gdb              # æŸ¥è¯¢åå­—ä¸­å«â€œgdbâ€å­—ç¬¦çš„åŒ…
pacman -S  ucrt64/mingw-w64-ucrt-x86_64-gdb     # å®‰è£…gdbè½¯ä»¶
gdb  --help                 # è·å–gdbå‘½ä»¤è¡Œå‚æ•°çš„å¸®åŠ©æ–‡æ¡£
</code></pre>
<p>ä½¿ç”¨GDBè½¯ä»¶çš„å‘½ä»¤è¡Œæ¨¡å¼æ›´å¼ºå¤§ï¼Œä½†ä¹Ÿå¯¹ä½¿ç”¨è€…çš„è¦æ±‚ä¹Ÿæ›´é«˜ã€‚<br>
åœ¨VS Codeä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡å®‰è£…<code>GDB Debugger - Beyond</code>æ’ä»¶æ‰©å±•æ¥è¿è¡Œ<strong>å›¾å½¢åŒ–çš„GDBè°ƒè¯•æµç¨‹</strong>ã€‚</p>
<p><img src="https://dev.azure.com/coolchyni/00de68fc-20fd-4cff-8681-a0a0be966def/_apis/git/repositories/ce435a7c-1ae2-41d1-b97d-5c3f504c4c92/items?path=%2fbeyond-debug.gif&amp;versionDescriptor%5bversionOptions%5d=0&amp;versionDescriptor%5bversionType%5d=0&amp;versionDescriptor%5bversion%5d=master&amp;resolveLfs=true&amp;format=octetStream&amp;api-version=5.0" alt="GDB" /></p>
<p>ä½ éœ€è¦åšçš„æ˜¯å…ˆå®Œæ•´åœ°é˜…è¯»<a href="https://marketplace.visualstudio.com/items?itemName=coolchyni.beyond-debug">å®ƒçš„æ¦‚è¿°ğŸ“Œ</a>ï¼ˆä¸Šé¢åŠ¨å›¾æ¥è‡ªè¯¥æ¦‚è¿°é“¾æ¥ï¼‰ï¼Œ
ç„¶ååœ¨<code>GDB Debugger - Beyond</code>æ’ä»¶ç”Ÿæˆçš„<code>.vscode/launch.json</code>æ–‡ä»¶ä¸­è®¾ç½®å¥½è¾“å‡º<code>-g</code>åçš„å¯æ‰§è¡Œç¨‹åº<code>*.exe</code>ï¼Œè®¾ç½®å¥½æ–­ç‚¹ï¼Œå¯åŠ¨è°ƒè¯•æ¨¡å¼ï¼</p>
<pre><code class="language-json">{
    &quot;version&quot;: &quot;0.2.0&quot;,
    &quot;configurations&quot;: [
        {
            &quot;type&quot;: &quot;by-gdb&quot;,
            &quot;request&quot;: &quot;launch&quot;,
            &quot;name&quot;: &quot;Launch(gdb)&quot;,
            &quot;program&quot;: &quot;./a.exe&quot;,  // è®¾ç½®å¥½è¾“å‡º`-g`çš„å«è°ƒè¯•ä¿¡æ¯çš„å¯æ‰§è¡Œç¨‹åºï¼Œæœ€å¥½ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç®€å•æ˜“ç”¨ã€‚
            &quot;cwd&quot;: &quot;${workspaceRoot}&quot;
        }
    ]
}
</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬æŸ¥æ‰¾ä»£ç BUGï¼ŒGFortranæä¾›äº†ä¸€äº›éå¸¸æœ‰ç”¨çš„ç¼–è¯‘é€‰é¡¹ï¼Œå¯ä»¥è¿›è¡Œç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶çš„ç¤ºè­¦å’ŒæŠ¥é”™ã€‚<br></p>
<pre><code class="language-sh"># -fcheck=bounds: æ•°ç»„è¶Šç•Œæ£€æŸ¥
# -std=f2008: å¼ºåˆ¶ä½¿ç”¨Fortran2008çš„è¯­æ³•è§„èŒƒï¼Œä¿è¯ç¨‹åºè·¨ç¼–è¯‘å™¨ï¼Œè·¨å¹³å°
# -Wall: æ£€æŸ¥ä¸€äº›å¸¸è§çš„Warningï¼Œä¾‹å¦‚å˜é‡æœªä½¿ç”¨ï¼Œå˜é‡æœªåˆå§‹åŒ–ç­‰ç­‰
# ... ...
gfortran -g -fcheck=bounds -std=f2008 -Wall hello_world.f90
</code></pre>
<p>æˆ‘ä»¬æ¨èä½¿ç”¨FPMè½¯ä»¶æ¥æ„å»ºä»£ç ï¼ŒFPMé»˜è®¤ä¼šå¯ç”¨ä¸€äº›ç¼–è¯‘é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œ</p>
<pre><code>-Wall -Wextra -Wimplicit-interface -fPIC -fmax-errors=1 -g -fcheck=bounds -fcoarray=single
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
